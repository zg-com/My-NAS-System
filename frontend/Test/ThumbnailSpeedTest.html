<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>NAS å›¾ç‰‡åŠ è½½ç«é€Ÿæµ‹è¯•</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f5f5f5; }
        .controls { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; gap: 10px; align-items: center; margin-bottom: 20px; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        
        .race-track { display: flex; gap: 20px; }
        .lane { flex: 1; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; }
        .lane h3 { margin-top: 0; color: #333; }
        
        .img-box { 
            height: 300px; 
            background: #eee; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin: 10px 0; 
            overflow: hidden; 
            border: 2px solid transparent;
        }
        .img-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        /* çŠ¶æ€é¢œè‰² */
        .status { font-weight: bold; font-size: 1.2em; margin-top: 10px; }
        .loading { color: #f39c12; border-color: #f39c12; }
        .finished { color: #27ae60; border-color: #27ae60; }
        
        .metrics { font-size: 0.9em; color: #666; text-align: left; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="controls">
        <label>æ–‡ä»¶ID:</label>
        <input type="number" id="fileIdInput" placeholder="è¾“å…¥æ–‡ä»¶ID (å¦‚: 5)">
        <label>ç”¨æˆ·ID:</label>
        <input type="number" id="userIdInput" value="1" placeholder="ç”¨æˆ·ID">
        <button onclick="startRace()">ğŸ å¼€å§‹ç«é€Ÿ</button>
        <span style="color:red; font-size:12px; margin-left:10px;">*è¯·å…ˆåœ¨ F12 Network ä¸­å¼€å¯ 'Fast 3G' å¹¶å‹¾é€‰ 'Disable Cache'</span>
    </div>

    <div class="race-track">
        <div class="lane">
            <h3>Level 1: ç¼©ç•¥å›¾ (400px)</h3>
            <div id="box-thumb" class="img-box">ç­‰å¾…å¼€å§‹...</div>
            <div id="result-thumb" class="metrics"></div>
        </div>

        <div class="lane">
            <h3>Level 2: é¢„è§ˆå›¾ (1920px)</h3>
            <div id="box-preview" class="img-box">ç­‰å¾…å¼€å§‹...</div>
            <div id="result-preview" class="metrics"></div>
        </div>

        <div class="lane">
            <h3>Level 3: åŸå›¾ (Original)</h3>
            <div id="box-original" class="img-box">ç­‰å¾…å¼€å§‹...</div>
            <div id="result-original" class="metrics"></div>
        </div>
    </div>

    <script>
        // âš ï¸ è¯·ä¿®æ”¹ä¸ºä½ çš„è™šæ‹Ÿæœº IP
        const API_BASE = 'http://192.168.177.133:8080'; 
        const CURRENT_USER_ID = 1;
        function startRace() {
            const fileId = document.getElementById('fileIdInput').value;
            const userId = document.getElementById('userIdInput').value;

            if (!fileId) { alert("è¯·è¾“å…¥æ–‡ä»¶ID"); return; }

            // æ¸…ç©ºä¸Šä¸€è½®
            resetLane('thumb');
            resetLane('preview');
            resetLane('original');

            // åŠ ä¸Šæ—¶é—´æˆ³ ?t=... æ˜¯ä¸ºäº†å¼ºåˆ¶æ¬ºéª—æµè§ˆå™¨ï¼Œè®©å®ƒç»å¯¹ä¸è¦ç”¨ç¼“å­˜ï¼Œå¿…é¡»å»æœåŠ¡å™¨é‡æ–°ä¸‹
            const timestamp = new Date().getTime();
            
            // æ„é€ ä¸‰ä¸ª URL
            const urlThumb = `${API_BASE}/file/img/thumbnail/${fileId}?userId=${userId}&t=${timestamp}`;
            const urlPreview = `${API_BASE}/file/img/preview/${fileId}?userId=${userId}&t=${timestamp}`;
            const urlOriginal = `${API_BASE}/file/${fileId}?userId=${userId}&t=${timestamp}`; // åŸå›¾æ¥å£å¯èƒ½æ²¡æ”¹åï¼ŒæŒ‰ä½ å®é™…çš„æ¥

            // å‘ä»¤æªå“ï¼
            loadImage('thumb', urlThumb);
            loadImage('preview', urlPreview);
            loadImage('original', urlOriginal);
        }

        function loadImage(type, url) {
            const box = document.getElementById(`box-${type}`);
            const resultDiv = document.getElementById(`result-${type}`);
            
            box.innerHTML = '<span style="color:orange">åŠ è½½ä¸­...</span>';
            box.classList.add('loading');
            
            const startTime = performance.now(); // è®°å½•å¼€å§‹æ—¶é—´ (ç²¾ç¡®åˆ°å¾®ç§’)

            const img = new Image();
            
            img.onload = function() {
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2); // ç®—å‡ºè€—æ—¶
                
                box.innerHTML = '';
                box.appendChild(img);
                box.classList.remove('loading');
                box.classList.add('finished');

                // æ˜¾ç¤ºæˆç»©
                resultDiv.innerHTML = `
                    <p>â±ï¸ è€—æ—¶: <b>${duration} ms</b></p>
                    <p>ğŸ çŠ¶æ€: åŠ è½½å®Œæˆ</p>
                `;
            };

            img.onerror = function() {
                box.innerHTML = '<span style="color:red">åŠ è½½å¤±è´¥</span>';
                resultDiv.innerHTML = '<p>âŒ è¯·æ±‚é”™è¯¯ (å¯èƒ½IDä¸å­˜åœ¨)</p>';
            };

            // å¼€å§‹ä¸‹è½½
            img.src = url;
        }

        function resetLane(type) {
            const box = document.getElementById(`box-${type}`);
            const resultDiv = document.getElementById(`result-${type}`);
            box.innerHTML = 'ç­‰å¾…å¼€å§‹...';
            box.className = 'img-box';
            resultDiv.innerHTML = '';
        }
    </script>
</body>
</html>